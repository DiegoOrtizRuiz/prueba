--- Sentencias SQL para la creaci�n del esquema de parranderos
--- Las tablas tienen prefijo A_ para facilitar su acceso desde SQL Developer

-- USO
-- Copie el contenido de este archivo en una pesta�a SQL de SQL Developer
-- Ejec�telo como un script - Utilice el bot�n correspondiente de la pesta�a utilizada

-- Creaci�n del secuenciador
create sequence alohandes_sequence;

-- Creaaci�n de la tabla OPERADORES y especificaci�n de sus restricciones
CREATE TABLE OPERADORES
   (ID NUMBER, 
	NOMBRE VARCHAR2(255 BYTE), 
    TIPO VARCHAR2(255 BYTE),
	CONSTRAINT OPERADORES_PK PRIMARY KEY (ID));
	
ALTER TABLE OPERADORES
	ADD CONSTRAINT UN_TIPO_OP_NOMBRE 
	UNIQUE (NOMBRE)
ENABLE;
    
ALTER TABLE OPERADORES
    ADD CONSTRAINT CK_OP_TIPO
    CHECK (TIPO IN ('Persona Natural', 'Hotel', 'Hostal', 'Residencia Universitaria'))
ENABLE;


-- Creaaci�n de la tabla DETALLE_OPERADOR y especificaci�n de sus restricciones
CREATE TABLE DETALLE_OPERADORES
   (IDOPERADOR NUMBER, 
    REGISTRO_CC NUMBER (10,0),
    REGISTRO_SUPERT NUMBER (10,0),
    VINCULO VARCHAR2(255 BYTE),
	CONSTRAINT DETALLE_OPERADORES_PK PRIMARY KEY (IDOPERADOR, VINCULO));
	
ALTER TABLE DETALLE_OPERADORES
ADD CONSTRAINT FK_DETALLE_OPERADORES
    FOREIGN KEY (IDOPERADOR)
    REFERENCES OPERADORES(ID)
ENABLE;

ALTER TABLE DETALLE_OPERADORES
	ADD CONSTRAINT UN_TIPO_OP_FK 
	UNIQUE (IDOPERADOR)
ENABLE;

ALTER TABLE DETALLE_OPERADORES
    ADD CONSTRAINT CK_DO_VINCULO
    CHECK (VINCULO IN ('Estudiante', 'Profesor', 'Profesor invitado', 'Egresado', 'Padre', 'Empleado','Empresa'))
ENABLE;

-- Creaaci�n de la tabla ALOJAMIENTO y especificaci�n de sus restricciones
CREATE TABLE ALOJAMIENTO
   (ID NUMBER, 
	  IDOPERADOR NUMBER,
    TIPO VARCHAR2(255 BYTE),
    OCUPADO NUMBER DEFAULT 0,
	CONSTRAINT ALOJAMIENTO_PK PRIMARY KEY (ID));

ALTER TABLE ALOJAMIENTO
ADD CONSTRAINT FK_ALOJAMIENTO
    FOREIGN KEY (IDOPERADOR)
    REFERENCES OPERADORES(ID)
ENABLE;

ALTER TABLE ALOJAMIENTO
  ADD CONSTRAINT CK_OCUPADO
  CHECK (OCUPADO IN (1,0))
ENABLE;

ALTER TABLE ALOJAMIENTO
	ADD CONSTRAINT CK_TIPO_ALOJ 
	CHECK (TIPO IN ('Habitacion', 'Apartamento', 'Vivienda Personal'))
ENABLE;

-- Creaaci�n de la tabla DETALLES_ALOJ y especificaci�n de sus restricciones
CREATE TABLE DETALLES_ALOJ
( 
  IDALOJAMIENTO NUMBER,
  CATEGORIA VARCHAR2(255 BYTE),
  CAPACIDAD NUMBER,
  SERVICIOS NUMBER,
  COSTO_SEGURO NUMBER,
  COSTO_ADMON NUMBER,
  AMOBLADO NUMBER,
  CONSTRAINT DETALLES_ALOJ_PK PRIMARY KEY (IDALOJAMIENTO, CATEGORIA));

ALTER TABLE DETALLES_ALOJ
ADD CONSTRAINT FK_DA_ALOJAMIENTO
    FOREIGN KEY (IDALOJAMIENTO)
    REFERENCES ALOJAMIENTO(ID)
ENABLE;

ALTER TABLE DETALLES_ALOJ
	ADD CONSTRAINT CK_DA_SERVICIOS
	CHECK (SERVICIOS IN (1,0))
ENABLE;

ALTER TABLE DETALLES_ALOJ
	ADD CONSTRAINT CK_DA_AMOBLADO
	CHECK (AMOBLADO IN (1,0))
ENABLE;

ALTER TABLE DETALLES_ALOJ
	ADD CONSTRAINT CK_DA_CATEGORIA
	CHECK (CATEGORIA IN ('Suite', 'Semisuite', 'Estandar', 'Compartida', 'Individual'))
ENABLE;

ALTER TABLE DETALLES_ALOJ
	ADD CONSTRAINT CK_DA_COSTO_SEGURO
	CHECK (COSTO_SEGURO >= 0)
ENABLE;

ALTER TABLE DETALLES_ALOJ
	ADD CONSTRAINT CK_DA_COSTO_ADMON
	CHECK (COSTO_ADMON >= 0)
ENABLE;

ALTER TABLE DETALLES_ALOJ
	ADD CONSTRAINT UN_TIPO_ALOJ_FK 
	UNIQUE (IDALOJAMIENTO)
ENABLE;


-- Creaaci�n de la tabla OFERTA y especificaci�n de sus restricciones

CREATE TABLE OFERTA
( 
  ID NUMBER,
  IDALOJAMIENTO NUMBER,
  IDOPERADOR NUMBER,
  FECHA DATE,
  COSTO NUMBER,
  TIEMPO_LIMITE_DIAS NUMBER,
  RESERVADA NUMBER DEFAULT 0,
  CONSTRAINT OFERTA_PK PRIMARY KEY (ID));

ALTER TABLE OFERTA
ADD CONSTRAINT FK_O_OPERADOR
    FOREIGN KEY (IDOPERADOR)
    REFERENCES OPERADORES(ID)
ENABLE;

ALTER TABLE OFERTA
ADD CONSTRAINT CK_RESERVADA
  CHECK (RESERVADA IN (1,0))
ENABLE;
    
ALTER TABLE OFERTA
ADD CONSTRAINT FK_O_ALOJAMIENTO
    FOREIGN KEY (IDALOJAMIENTO)
    REFERENCES ALOJAMIENTO(ID)
ENABLE;

ALTER TABLE OFERTA
	ADD CONSTRAINT CK_O_COSTO
	CHECK (COSTO > 0)
ENABLE;

ALTER TABLE OFERTA
	ADD CONSTRAINT CK_O_TIEMPO
	CHECK (TIEMPO_LIMITE_DIAS > 0)
ENABLE;


-- Creaaci�n de la tabla RESIDENTE y especificaci�n de sus restricciones
CREATE TABLE RESIDENTE
( 
  ID NUMBER,
  NOMBRE VARCHAR2(255 BYTE),
  VINCULO VARCHAR2(255 BYTE),
  CONSTRAINT RESIDENTE_PK PRIMARY KEY (ID));

ALTER TABLE RESIDENTE
	ADD CONSTRAINT UN_TIPO_R_NOMBRE 
	UNIQUE (NOMBRE)
ENABLE;
    
ALTER TABLE RESIDENTE
    ADD CONSTRAINT CK_R_TIPO
    CHECK (VINCULO IN ('Estudiante', 'Profesor', 'Profesor invitado', 'Egresado', 'Padre', 'Empleado', 'Asistente a evento'))
ENABLE;


-- Creaaci�n de la tabla RESERVA y especificaci�n de sus restricciones

CREATE TABLE RESERVA
( 
  ID NUMBER,
  IDRESIDENTE NUMBER,
  FECHA DATE,
  DURACION_DIAS NUMBER,
  ACTIVO NUMBER DEFAULT 1,
  COLECTIVA NUMBER DEFAULT NULL,
  CONSTRAINT RESERVA_PK PRIMARY KEY (ID));

ALTER TABLE RESERVA
ADD CONSTRAINT FK_R_RESIDENTE
    FOREIGN KEY (IDRESIDENTE)
    REFERENCES RESIDENTE(ID)
ENABLE;

ALTER TABLE RESERVA
	ADD CONSTRAINT CK_R_DURACION
	CHECK (DURACION_DIAS > 0)
ENABLE;

ALTER TABLE RESERVA
  ADD CONSTRAINT CK_R_ACTIVO
  CHECK (ACTIVO IN (1,0))
ENABLE;

-- Creaaci�n de la tabla SERVICIO y especificaci�n de sus restricciones

CREATE TABLE SERVICIO
( 
  ID NUMBER,
  NOMBRE VARCHAR2(255 BYTE),
  COSTO NUMBER,
  CONSTRAINT SERVICIO_PK PRIMARY KEY (ID));

ALTER TABLE SERVICIO
	ADD CONSTRAINT UN_TIPO_S_NOMBRE 
	UNIQUE (NOMBRE)
ENABLE;

ALTER TABLE SERVICIO
	ADD CONSTRAINT CK_S_COSTO
	CHECK (COSTO >= 0)
ENABLE;

-- Creaaci�n de la tabla RESIDEN y especificaci�n de sus restricciones

CREATE TABLE RESIDEN
( 
  IDRESERVA NUMBER,
  IDOFERTA NUMBER,
  CONSTRAINT RESIDEN_PK PRIMARY KEY (IDRESERVA,IDOFERTA));

  ALTER TABLE RESIDEN
    ADD CONSTRAINT FK_RN_RESERVA
    FOREIGN KEY (IDRESERVA)
    REFERENCES RESERVA(ID)
ENABLE;

  ALTER TABLE RESIDEN
    ADD CONSTRAINT FK_RN_OFERTA
    FOREIGN KEY (IDOFERTA)
    REFERENCES OFERTA(ID)
ENABLE;

-- Creaaci�n de la tabla TIENE_SERVICIO y especificaci�n de sus restricciones

CREATE TABLE TIENE_SERVICIO
( 
  IDALOJAMIENTO NUMBER,
  IDSERVICIO NUMBER,
  CONSTRAINT TIENE_SERVICIO_PK PRIMARY KEY (IDALOJAMIENTO,IDSERVICIO));

  ALTER TABLE TIENE_SERVICIO
    ADD CONSTRAINT FK_TS_SERVICIO
    FOREIGN KEY (IDSERVICIO)
    REFERENCES SERVICIO(ID)
ENABLE;

  ALTER TABLE TIENE_SERVICIO
    ADD CONSTRAINT FK_TS_ALOJAMIENTO
    FOREIGN KEY (IDALOJAMIENTO)
    REFERENCES ALOJAMIENTO(ID)
ENABLE;

CREATE TABLE GANANCIAS
( 
  IDOPERADOR NUMBER,
  GANANCIAS NUMBER DEFAULT 0,
  CONSTRAINT GANANCIAS_PK PRIMARY KEY (IDOPERADOR));

  ALTER TABLE GANANCIAS
    ADD CONSTRAINT FK_G_OPERADOR
    FOREIGN KEY (IDOPERADOR)
    REFERENCES OPERADORES(ID)
ENABLE;

CREATE TABLE DESHABILITADAS (
  IDOFERTA NUMBER,
  CONSTRAINT DESHABILITADAS_PK PRIMARY KEY (IDOFERTA));

  ALTER TABLE DESHABILITADAS
    ADD CONSTRAINT FK_D_OFERTA
    FOREIGN KEY (IDOFERTA)
    REFERENCES OFERTA(ID)
ENABLE;

COMMIT;



